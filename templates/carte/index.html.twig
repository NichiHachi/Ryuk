{% extends 'base.html.twig' %}

{% block stylesheets %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
	integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<style>
	html,
	body {
		height: 100%;
		margin: 0;
	}

	.leaflet-container {
		height: 400px;
		width: 600px;
		max-width: 100%;
		max-height: 100%;
	}
</style>
{% endblock %}

{% block javascripts %}
<script class="carte" src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
	integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
{% endblock %}

{% block title %}Ryuk - Carte{% endblock %}

{% block content %}
<h2>Défibrillateurs, hôpitaux, cimetières</h2>
<p id="locate_status">Chargement de la position ...</p>
<article>
	<div id="map" style="width: auto; height: 68vh; position:center"></div>

	<script>
		const defaultLocation = [37.764848, 125.625902];
		
		const map = L.map('map');

		map.locate({setView: true, maxZoom: 20});

		function setView(location, zoom) {
			const mapView = map.setView(location, zoom);
			let tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 20,
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			}).addTo(map);
		}

		map.addEventListener("locationerror", function (event) {
			setView(defaultLocation, 19);
			document.getElementById("locate_status").innerText = "La localisation a été refusée !";
		});

		map.addEventListener("locationfound", function (event) {
			setView(event.latlng, 16);
			document.getElementById("locate_status").innerText = "La localisation a été acceptée !";
		});

	</script>

</article>
{% endblock %}